# Система рейтинга учеников и классов

## Описание

Система рейтинга позволяет ученикам и администраторам видеть:
- **Общий рейтинг учеников** - позиции всех учеников школы по набранным очкам
- **Рейтинг классов** - сравнение классов по общему количеству очков и среднему количеству очков на ученика
- **Позицию ученика в своем классе** - рейтинг среди одноклассников
- **Личную статистику** - позицию в школе, классе, количество очков и достижений

## Функциональность

### Рейтинг учеников
- Сортировка по общему количеству очков (убывание)
- Отображение позиции, ФИО, класса, очков и количества достижений
- Выделение текущего пользователя в списке
- Топ-10 учеников школы на главной странице

### Рейтинг классов
- Сортировка классов по общему количеству очков
- Отображение позиции, класса, общих очков, среднего количества очков на ученика
- Количество учеников в классе и общее количество достижений
- Выделение класса текущего пользователя

### Личная статистика
- Позиция ученика в общем рейтинге школы
- Позиция класса ученика в рейтинге классов  
- Общее количество очков и достижений
- Интеграция с главной страницей

## API Endpoints

### GET /api/rankings/students
Получение общего рейтинга учеников
```json
{
  "rankings": [
    {
      "id": 1,
      "first_name": "Иван",
      "last_name": "Иванов", 
      "class_grade": 10,
      "class_letter": "А",
      "avatar_url": "...",
      "total_points": 150,
      "achievements_count": 5,
      "rank_position": 1
    }
  ],
  "currentUser": { ... }
}
```

### GET /api/rankings/classes
Получение рейтинга классов
```json
{
  "rankings": [
    {
      "class_grade": 10,
      "class_letter": "А", 
      "total_points": 500,
      "students_count": 25,
      "total_achievements": 20,
      "avg_points_per_student": 20.0,
      "rank_position": 1
    }
  ],
  "currentUserClass": { ... }
}
```

### GET /api/rankings/stats
Получение общей статистики и позиции пользователя
```json
{
  "totalStudents": 100,
  "totalClasses": 12,
  "totalPoints": 5000,
  "userStats": {
    "points": 150,
    "achievements": 5,
    "rank": 10,
    "classRank": 2
  }
}
```

### GET /api/rankings/top-students
Получение топ-10 учеников школы
```json
{
  "topStudents": [...]
}
```

### GET /api/rankings/students/:grade/:letter
Получение рейтинга учеников конкретного класса
```json
{
  "rankings": [...]
}
```

## Frontend компоненты

### /src/pages/Rankings.tsx
Основная страница рейтинга с тремя вкладками:
- Рейтинг учеников
- Рейтинг классов  
- Мой класс

### /src/hooks/useRankings.ts
React Query хуки для загрузки данных рейтинга:
- `useStudentRankings()` - общий рейтинг учеников
- `useClassRankings()` - рейтинг классов
- `useTopStudents()` - топ-10 учеников
- `useRankingStats()` - статистика пользователя
- `useClassStudentRankings()` - рейтинг класса

### Интеграция с Dashboard
- Карточка с позициями пользователя (в школе, классе)
- Топ-3 ученика школы
- Быстрый переход к полному рейтингу

## База данных

Система использует существующие таблицы:
- `users` - информация об учениках
- `achievements` - список достижений с очками
- `user_achievements` - связь учеников с достижениями

Рейтинг рассчитывается динамически через SQL запросы с `SUM()` и `RANK()` функциями.

## Особенности реализации

1. **Реальное время** - данные обновляются при каждом запросе
2. **Производительность** - используются индексы в БД и React Query для кэширования
3. **Адаптивный дизайн** - компоненты адаптированы для мобильных устройств
4. **Выделение текущего пользователя** - подсветка своей позиции в рейтинге
5. **Иконки позиций** - корона для 1-го места, медали для 2-3 места
6. **Анимации** - плавные переходы и эффекты наведения

## Тестирование

Для демонстрации используется скрипт `backend/scripts/addTestAchievements.js` который:
- Добавляет случайные достижения всем студентам
- Создает разнообразие в очках для демонстрации рейтинга
- Выводит текущий рейтинг в консоль

Запуск: `node backend/scripts/addTestAchievements.js`